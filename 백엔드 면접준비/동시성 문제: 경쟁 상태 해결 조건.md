## ë™ì‹œì„± ë¬¸ì œ ì¤‘ ê²½ìŸ ìƒíƒœë¥¼ í•´ê²°í•˜ë ¤ë©´ ë¬´ì—‡ì´ ë³´ì¥ë˜ì–´ì•¼ í•˜ë‚˜ìš”? (JAVA)

**ê²½ìŸ ìƒíƒœ(Race Condition)** ëŠ” ë‘ ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ê³µìœ  ìì›ì— ë™ì‹œì— ì ‘ê·¼í•  ë•Œ, ìŠ¤ë ˆë“œ ê°„ì˜ ì‹¤í–‰ ìˆœì„œì— ë”°ë¼ ê²°ê³¼ê°€ ë‹¬ë¼ì§€ëŠ” í˜„ìƒì…ë‹ˆë‹¤.  
ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ **ì›ìì„±(Atomicity)** ê³¼ **ê°€ì‹œì„±(Visibility)** ì´ ëª¨ë‘ ë³´ì¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

---

### âœ… ì›ìì„± (Atomicity)

ê³µìœ  ìì›ì— ëŒ€í•œ ì‘ì—…ì´ **ë” ì´ìƒ ë‚˜ëˆŒ ìˆ˜ ì—†ëŠ” í•˜ë‚˜ì˜ ì—°ì‚°ì²˜ëŸ¼ ë™ì‘í•˜ëŠ” ì„±ì§ˆ**ì…ë‹ˆë‹¤.

#### â— ì›ìì„±ì„ ë³´ì¥í•˜ì§€ ì•Šìœ¼ë©´?

ì˜ˆ: `i++` ì—°ì‚°ì€ ë‹¨ì¼ ì—°ì‚°ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ì‹¤ì œë¡œëŠ” ì„¸ ë‹¨ê³„ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.

```java
i = i + 1; // ë‚´ë¶€ì ìœ¼ë¡œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •:
1. Read   // iì˜ í˜„ì¬ ê°’ì„ ì½ìŒ
2. Modify // 1ì„ ë”í•¨
3. Write  // ê²°ê³¼ë¥¼ ë‹¤ì‹œ iì— ì €ì¥
```

ë‘ ê°œì˜ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— `i++`ì„ ìˆ˜í–‰í•  ê²½ìš° ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- Thread 1ì´ i ê°’ì„ ì½ê³  ìˆëŠ” ë™ì•ˆ
- Thread 2ë„ i ê°’ì„ ì½ì–´ì„œ `i+1`ì„ ìˆ˜í–‰í•˜ê³  ì €ì¥
- Thread 1ì´ ê·¸ ì´í›„ì— ê³„ì‚°í•œ ê°’ì„ ì €ì¥ â†’ **Thread 2ì˜ ê²°ê³¼ê°€ ë®ì–´ì“°ê¸°ë˜ì–´ ë¬´ì‹œë¨**

---

### âœ… ê°€ì‹œì„± (Visibility)

í•œ ìŠ¤ë ˆë“œì—ì„œ ë³€ê²½í•œ ê°’ì´ **ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì¦‰ì‹œ í™•ì¸ë  ìˆ˜ ìˆëŠ” ì„±ì§ˆ**ì…ë‹ˆë‹¤.

#### â— ê°€ì‹œì„±ì„ ë³´ì¥í•˜ì§€ ì•Šìœ¼ë©´?

í˜„ëŒ€ CPUëŠ” ê° ì½”ì–´ë§ˆë‹¤ ìºì‹œë¥¼ ê°€ì§€ê³  ìˆì–´ **ë³€ê²½ëœ ê°’ì´ ì¦‰ì‹œ ë©”ì¸ ë©”ëª¨ë¦¬ì— ë°˜ì˜ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

- Thread Aê°€ ë³€ìˆ˜ `v = true`ë¡œ ë³€ê²½í•´ë„,
- Thread BëŠ” ë©”ì¸ ë©”ëª¨ë¦¬ì— ë°˜ì˜ë˜ê¸° ì „ê¹Œì§€ ì—¬ì „íˆ `v = false`ë¡œ ë³¼ ìˆ˜ ìˆìŒ

â†’ ìŠ¤ë ˆë“œ ê°„ ì˜ë„í•œ ë™ê¸°í™”ê°€ ì´ë£¨ì–´ì§€ì§€ ì•ŠìŒ

---

## Javaì—ì„œì˜ í•´ê²° ë°©ë²•

| ë³´ì¥ í•­ëª©       | ë°©ë²•                                                                     |
| --------------- | ------------------------------------------------------------------------ |
| ì›ìì„± + ê°€ì‹œì„± | `synchronized`, `ReentrantLock`, `AtomicInteger`, `ConcurrentHashMap` ë“± |
| ê°€ì‹œì„±ë§Œ        | `volatile` (ë‹¨, ì“°ê¸° ì‘ì—…ì€ í•œ ìŠ¤ë ˆë“œì—ì„œë§Œ ìˆ˜í–‰í•´ì•¼ ì•ˆì „)               |

---

### ğŸ”§ ì˜ˆì‹œ: `AtomicInteger` ì‚¬ìš©

```java
AtomicInteger counter = new AtomicInteger(0);

public void increment() {
    counter.incrementAndGet(); // ì›ìì  ì—°ì‚°
}
```

---

### ğŸ”§ ì˜ˆì‹œ: `synchronized` ì‚¬ìš©

```java
private int counter = 0;

public synchronized void increment() {
    counter++; // ë™ê¸°í™” ë¸”ë¡ìœ¼ë¡œ ì›ìì„±+ê°€ì‹œì„± ë³´ì¥
}
```

---

### ğŸ”§ ì˜ˆì‹œ: `volatile` ì‚¬ìš©

```java
private volatile boolean ready = false;

public void writer() {
    ready = true; // write
}

public void reader() {
    if (ready) {
        // ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ë³€ê²½í•œ ê°’ì„ ë³¼ ìˆ˜ ìˆìŒ
    }
}
```

---


# Node.js í™˜ê²½ì—ì„œ ê²½ìŸ ìƒíƒœ(Race Condition) í•´ê²°í•˜ê¸°

ê²½ìŸ ìƒíƒœ(Race Condition)ëŠ” ë‘ ê°œ ì´ìƒì˜ ë¹„ë™ê¸° ì‘ì—…ì´ ê³µìœ  ìì›ì— ë™ì‹œì— ì ‘ê·¼í•  ë•Œ ë°œìƒí•˜ë©°, ì‹¤í–‰ ìˆœì„œì— ë”°ë¼ ê²°ê³¼ê°€ ë‹¬ë¼ì§€ëŠ” í˜„ìƒì…ë‹ˆë‹¤. Node.jsëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œ ì´ë²¤íŠ¸ ë£¨í”„ ëª¨ë¸ì´ì§€ë§Œ, ë¹„ë™ê¸° ì‘ì—…ì´ë‚˜ ë©€í‹° í”„ë¡œì„¸ìŠ¤ í™˜ê²½ì—ì„œëŠ” ì—¬ì „íˆ ê²½ìŸ ìƒíƒœê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì›ìì„±(Atomicity)

ì›ìì„±ì€ ê³µìœ  ìì›ì— ëŒ€í•œ ì‘ì—…ì´ ë” ì´ìƒ ìª¼ê°¤ ìˆ˜ ì—†ëŠ” í•˜ë‚˜ì˜ ì—°ì‚°ì²˜ëŸ¼ ì²˜ë¦¬ë˜ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. Node.jsì—ì„œëŠ” ë‹¨ì¼ ìŠ¤ë ˆë“œë¡œ ë™ì‘í•˜ì§€ë§Œ, ë¹„ë™ê¸° ì½”ë“œë‚˜ í´ëŸ¬ìŠ¤í„°, ì›Œì»¤ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•  ë•Œ ì›ìì„±ì´ ë³´ì¥ë˜ì§€ ì•Šìœ¼ë©´ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì—¬ëŸ¬ ë¹„ë™ê¸° í•¨ìˆ˜ê°€ ë™ì‹œì— ê°™ì€ íŒŒì¼ì— ì“°ê¸°ë¥¼ ì‹œë„í•˜ê±°ë‚˜, ë©”ëª¨ë¦¬ ë‚´ ê°ì²´ë¥¼ ìˆ˜ì •í•  ê²½ìš° ì›ìì„±ì„ ë³´ì¥í•˜ì§€ ì•Šìœ¼ë©´ ë°ì´í„°ê°€ ê¼¬ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ê°€ì‹œì„±(Visibility)

ê°€ì‹œì„±ì€ í•œ ì‘ì—…ì—ì„œ ë³€ê²½í•œ ê°’ì´ ë‹¤ë¥¸ ì‘ì—…ì—ì„œ ì¦‰ì‹œ í™•ì¸ ê°€ëŠ¥í•´ì•¼ í•˜ëŠ” ì„±ì§ˆì…ë‹ˆë‹¤. Node.jsì˜ ë‹¨ì¼ ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œëŠ” ë©”ëª¨ë¦¬ ê°€ì‹œì„± ë¬¸ì œê°€ ì ì§€ë§Œ, ë©€í‹° í”„ë¡œì„¸ìŠ¤ë‚˜ ì›Œì»¤ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ê³µìœ  ìì›ì˜ ë³€ê²½ ì‚¬í•­ì´ ê° í”„ë¡œì„¸ìŠ¤/ìŠ¤ë ˆë“œì— ì¦‰ì‹œ ë°˜ì˜ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Node.jsì—ì„œ ê²½ìŸ ìƒíƒœ í•´ê²° ë°©ë²•

- **ë®¤í…ìŠ¤(Mutex)ì™€ ì„¸ë§ˆí¬ì–´(Semaphore)**: íŒŒì¼ì´ë‚˜ ë©”ëª¨ë¦¬ ìì›ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œì–´í•˜ê¸° ìœ„í•´ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬(`async-mutex` ë“±)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **Atomic íŒŒì¼ ì‹œìŠ¤í…œ ì‘ì—…**: íŒŒì¼ ì‹œìŠ¤í…œ ì‘ì—… ì‹œì—ëŠ” `fs` ëª¨ë“ˆì˜ ì›ìì  ì‘ì—…(ex: `fs.rename`, `fs.appendFile`)ì„ í™œìš©í•˜ì—¬ ì¶©ëŒì„ ë°©ì§€í•©ë‹ˆë‹¤.

- **í´ëŸ¬ìŠ¤í„° ë˜ëŠ” ì›Œì»¤ ìŠ¤ë ˆë“œ ê°„ í†µì‹  ì‹œ ë©”ì‹œì§€ í(Message Queue)**: í”„ë¡œì„¸ìŠ¤ ê°„ ìƒíƒœ ë™ê¸°í™”ë¥¼ ìœ„í•´ Redis, RabbitMQ ê°™ì€ ë©”ì‹œì§€ íë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ì—… ìˆœì„œë¥¼ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **ë¹„ë™ê¸° í•¨ìˆ˜ ìˆœì„œ ì œì–´**: Promise, async/awaitë¥¼ ì´ìš©í•´ ë¹„ë™ê¸° ì‘ì—… ìˆœì„œë¥¼ ì œì–´í•˜ê³ , ê³µìœ  ìì› ì ‘ê·¼ì„ ì§ë ¬í™”í•©ë‹ˆë‹¤.

- **ì›ìì  ì—°ì‚°ì„ ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©**: ì˜ˆë¥¼ ë“¤ì–´, Redisì˜ INCR ëª…ë ¹ì€ ì›ìì  ì¹´ìš´í„° ì¦ê°€ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.

---

## ì˜ˆì‹œ ì½”ë“œ: async-mutexë¥¼ ì‚¬ìš©í•œ ê°„ë‹¨í•œ ë®¤í…ìŠ¤ êµ¬í˜„

```javascript
const { Mutex } = require("async-mutex");

const mutex = new Mutex();
let sharedCounter = 0;

async function incrementCounter() {
  const release = await mutex.acquire();
  try {
    // í¬ë¦¬í‹°ì»¬ ì„¹ì…˜: ê³µìœ  ìì› ì ‘ê·¼
    let current = sharedCounter;
    await new Promise((resolve) => setTimeout(resolve, 100)); // ë¹„ë™ê¸° ì‘ì—… ì‹œë®¬ë ˆì´ì…˜
    sharedCounter = current + 1;
    console.log("Counter:", sharedCounter);
  } finally {
    release();
  }
}

// ì—¬ëŸ¬ ë¹„ë™ê¸° ì‘ì—…ì—ì„œ ì•ˆì „í•˜ê²Œ ê³µìœ  ë³€ìˆ˜ ì¦ê°€
incrementCounter();
incrementCounter();
incrementCounter();
```
