# JPA `ddl-auto` 옵션 정리 (Hibernate / Spring Boot)

> 본 문서는 Spring Boot에서 Hibernate JPA 구현체를 사용할 때의 `spring.jpa.hibernate.ddl-auto` 동작을 정리한 것입니다.

## 한눈에 보기

| 값              | 동작                                    | 데이터 보존 | 권장 환경              | 비고                                            |
| --------------- | --------------------------------------- | ----------: | ---------------------- | ----------------------------------------------- |
| **none**        | 스키마 작업을 전혀 하지 않음            |           O | 프로덕션               | 수동/마이그레이션 도구로 관리                   |
| **validate**    | 엔티티 ↔ DB 스키마 **일치 여부만 검증** |           O | 프로덕션               | 불일치 시 애플리케이션 시작 실패                |
| **update**      | 차이점 감지 후 스키마 **자동 수정**     |           O | 로컬 개발, 내부 테스트 | 예측 불가 변경·다운타임 리스크, 프로덕션 비권장 |
| **create**      | 시작 시 기존 스키마 **드롭 후 재생성**  |           X | 로컬 개발, 샌드박스    | 데이터 전부 삭제, 시작마다 초기화               |
| **create-drop** | 시작 시 **생성**, **종료 시 드롭**      |           X | 테스트                 | 테스트 종료마다 깨끗한 상태 보장                |

---

## 옵션별 상세

### none

- **의미**: Hibernate가 데이터베이스 스키마에 대해 아무 작업도 수행하지 않습니다.
- **언제**: 스키마를 DBA/마이그레이션 도구(Flyway, Liquibase 등)로 관리할 때, 특히 **프로덕션**.
- **장점**: 안전하고 예측 가능.
- **주의**: 스키마 불일치를 런타임까지 모를 수 있으므로 `validate`와 병행 검토.

### validate

- **의미**: 애플리케이션 시작 시 엔티티 매핑과 DB 스키마의 **정합성만 검사**합니다. 수정은 하지 않습니다.
- **언제**: 프로덕션에서 **시작 단계 검증**을 원할 때.
- **결과**: 불일치가 있으면 부팅 실패로 조기 발견.
- **주의**: 생성/변경은 전혀 하지 않으므로, 사전 마이그레이션이 필수입니다.

### update

- **의미**: 엔티티-스키마 차이를 감지해 **스키마를 자동으로 갱신**합니다. 기존 데이터는 **가능한 한 보존**합니다.
- **언제**: 로컬 개발, 내부 테스트 **초기 생산성**을 높일 때 편리.
- **주의(중요)**: 프로덕션에서는 예측 불가한 DDL, 인덱스/제약조건 미흡, 다운타임 리스크가 있어 **비권장**입니다.

### create

- **의미**: 시작 시 기존 스키마를 **삭제**하고 엔티티 기반으로 **새로 생성**합니다.
- **언제**: 초기 개발, 데모, 데이터를 매번 초기화해도 되는 환경.
- **주의**: 데이터가 항상 **삭제**됩니다. 프로덕션 **사용 금지**.

### create-drop

- **의미**: 시작 시 **생성**, 애플리케이션 **종료 시 스키마 삭제**합니다.
- **언제**: 통합/단위 테스트에서 매 실행마다 깨끗한 데이터베이스가 필요할 때.
- **주의**: 종료 훅이 실행되지 못하면 드롭이 남지 않을 수 있습니다(비정상 종료 등).

---

## 환경별 권장 전략

- **프로덕션**: `none` 또는 `validate` + **마이그레이션 도구(Flyway/Liquibase)** 로 관리
  - 자동화된 스크립트로 버전 관리, 롤백 전략 수립, 검증/검수 절차 포함
- **스테이징/QA**: 실제와 유사한 환경을 위해 `validate`(또는 엄격히 `none`) + 마이그레이션 적용
- **개발/로컬**: 초기에는 `update` 또는 `create`로 민첩하게, 팀 규모/안정화 단계에 따라 마이그레이션 도구로 전환

---

## 설정 예시

### `application.properties`

```properties
# 프로덕션 예시
spring.jpa.hibernate.ddl-auto=validate

# 개발 예시
# spring.jpa.hibernate.ddl-auto=update
# spring.jpa.hibernate.ddl-auto=create
# spring.jpa.hibernate.ddl-auto=create-drop
```

### `application.yml`

```yaml
spring:
  jpa:
    hibernate:
      ddl-auto: validate # prod 권장: validate 또는 none
    properties:
      hibernate:
        # 필요 시 naming 전략, show_sql 등 추가
        # format_sql: true
```

---

## 마이그레이션 도구 사용 권장

- **권장 도구**: Flyway, Liquibase
- **이점**
  - 스키마 변경의 **히스토리/버전 관리**
  - **재현 가능**한 배포 파이프라인 구성(CI/CD)
  - **롤백** 전략 수립 가능
  - 환경별(개발/스테이징/프로덕션) **일관성** 확보
- **일반 절차**
  1. 엔티티 변경
  2. 마이그레이션 스크립트 생성(V1**init.sql, V2**add_index.sql 등)
  3. 스테이징에 적용 후 검증
  4. 프로덕션에 순차 반영

---

## 체크리스트

- [ ] 프로덕션에서 `update/create/create-drop`를 사용하고 있지 않은가
- [ ] 스키마 변경 시점과 방법이 **버전 관리**되고 있는가
- [ ] 시작 시 **정합성 검증**(validate) 또는 사전 점검이 수행되는가
- [ ] 롤백 및 장애 대응 방안이 준비되어 있는가
- [ ] 테스트 환경은 **create-drop**으로 격리 가능한가

---

## 요약

- `none`: 스키마를 건드리지 않음 → **프로덕션 기본값 후보**
- `validate`: 스키마 **검증만** 수행 → **프로덕션 권장**
- `update`: 자동 스키마 갱신 → **개발 편의용**, 프로덕션 **비권장**
- `create`/`create-drop`: **파괴적 초기화** → 개발/테스트에서만 사용

프로덕션 스키마 변경은 **Flyway/Liquibase 등 마이그레이션 도구**로 제어된 방식으로 진행하시기를 권장드립니다.
