# 의존성 주입(Dependency Injection, DI) 정리

## 1) 의존성이란?

- **A 객체가 어떤 작업을 수행하기 위해 B 객체가 필요**하면, A는 B에 **의존**합니다.
- 예) `OrderService`가 주문 저장을 위해 `OrderRepository`가 필요하다면, `OrderService -> OrderRepository` 의존성이 존재합니다.

---

## 2) 의존성 주입(DI)이란?

- **A가 직접 B를 생성하지 않고**, 외부(컨테이너/팩토리/조립자 역할의 C)가 **B를 만들어 A에 전달**해 A의 의존성을 해결하는 방식입니다.
- 핵심 효과
  - **결합도 감소**: A는 “B의 구체 구현/생성 방식”을 몰라도 됨
  - **유연성 증가**: 실행 환경(테스트/운영)에 따라 B 구현을 쉽게 교체
  - **테스트 용이성**: Mock/Fake 등을 주입해 단위 테스트가 쉬움

---

## 3) DI가 왜 필요한가?

### (1) 결합도를 낮춰 변경에 강해짐

- A 내부에서 `new B()`로 직접 생성하면, B 구현 변경이 A 변경으로 전파될 가능성이 큽니다.
- 주입 방식에서는 A는 B의 **인터페이스(역할)**만 알면 되므로, B 구현 교체가 쉬워집니다.

### (2) 재사용성과 구성 가능성 증가

- 동일한 A를 두고도
  - 운영: `RealRepository`
  - 테스트: `FakeRepository`
  - 로컬: `InMemoryRepository`
    같은 형태로 구성할 수 있습니다.

---

## 4) 의존성 주입 방식 3가지와 사용 시점

의존성 주입은 “어디에 주입하느냐”에 따라 크게 3가지로 나뉩니다.

### 4-1) 생성자 주입 (Constructor Injection)

**특징**

- 생성 시점에 의존성이 확정됩니다.
- 의존성이 `final`로 고정되기 쉬워 **불변 객체 설계**에 유리합니다.
- 객체가 **항상 완전한 상태로 생성**됩니다.

**언제 쓰나?**

- “없으면 동작 불가능한 필수 의존성”일 때
- 대부분의 경우 **가장 권장**되는 방식

**장점**

- 필수 의존성을 강제
- 테스트가 쉬움
- 순환 참조를 조기에 감지하기 쉬움(프레임워크에 따라)

**단점**

- 의존성이 너무 많아지면 생성자가 비대해져 설계 개선 신호가 될 수 있음

---

### 4-2) 세터 주입 (Setter Injection)

**특징**

- 객체 생성 후에 의존성을 주입합니다.
- 의존성이 선택적(optional)일 수 있습니다.

**언제 쓰나?**

- 선택 의존성(없어도 기본 동작 가능)일 때
- 런타임에 설정이 바뀔 수 있는 구성 값을 주입할 때(다만 주의 필요)

**장점**

- 선택 의존성을 유연하게 처리 가능
- 프레임워크 설정과 궁합이 좋을 때가 있음

**단점/주의**

- 주입 전까지 객체가 **불완전한 상태**일 수 있음
- 주입 누락 시 런타임 오류 가능(NullPointerException 등)
- 불변성 유지가 어려움

> 실무에서는 세터 주입만 단독 사용하기보다, 필수는 생성자 주입으로 받고 “정말 선택적인 것”만 세터로 받는 식의 혼합이 흔합니다.

---

### 4-3) 메서드 주입 (Method Injection)

**특징**

- 특정 메서드를 호출할 때, 그 메서드 인자로 의존성을 전달합니다.

**언제 쓰나?**

- 호출마다 의존 대상이 달라지는 **일시적 의존(Transient Dependency)** 이 필요할 때
- 예) “이번 요청에서는 A 전략, 다음 요청에서는 B 전략” 같이 실행마다 달라지는 경우
- 예) “파일 변환 함수에 변환기/정책을 매번 인자로 받는다”

**장점**

- 필요한 시점에만 의존성을 전달하므로 명확함
- 객체의 필드로 의존성을 유지하지 않아도 됨

**단점**

- 메서드 시그니처가 복잡해질 수 있음
- 여러 메서드에서 반복되면 코드가 장황해질 수 있음

---

## 5) DI 적용 시 자주 같이 나오는 개념

- **IoC(Inversion of Control, 제어의 역전)**: 객체 생성/연결의 제어권이 “내 코드”에서 “외부(컨테이너)”로 넘어가는 큰 개념
- **DI(Dependency Injection)**: IoC를 구현하는 대표적 기법 중 하나
- **DIP(Dependency Inversion Principle)**: “구체 클래스가 아니라 추상(인터페이스)에 의존하라”는 설계 원칙. DI와 궁합이 좋습니다.

---

## 6) 실무 팁(요약)

- 기본값: **생성자 주입을 우선**
- 선택 의존성: **세터 주입을 제한적으로**
- 호출마다 달라지는 의존성: **메서드 주입**
- 생성자가 비대해진다면: “클래스 책임이 과도한지(응집도)”를 점검하는 신호로 삼기
