# 코드 커버리지(Code Coverage) 정리

코드 커버리지는 **테스트가 프로덕션 코드를 얼마나 실행했는지**를 수치화한 지표입니다.  
“테스트가 실행한 양”을 보여주는 지표이지, “테스트가 얼마나 잘 검증했는지”를 직접 보장하진 않습니다.

---

## 1) 코드 커버리지의 대표 기준

### 1. 구문 커버리지(Statement / Line Coverage)

- **코드의 각 구문(라인)이 실행되었는지**를 측정합니다.
- 예: 5줄짜리 메서드에서 5줄 모두 한 번이라도 실행되면 **100%**.

장점

- 이해하기 쉽고 도구 지원이 풍부합니다.

한계

- 라인은 실행됐지만 **검증(assert)이 부실**하면 버그를 놓칠 수 있습니다.
- 분기(조건) 로직의 양쪽 경로가 실행되었는지까지는 보장하지 못합니다.

---

### 2. 결정 커버리지(Decision / Branch Coverage)

- **분기 조건식 전체가 참/거짓으로 평가되는 경우가 최소 1번씩** 실행되었는지를 봅니다.
- 흔히 “브랜치 커버리지”로 부릅니다.

예시

```java
public void productionCode(int a, int b) {
    if (a > 0 && b > 0) { // decision(분기)
        // ...
    }
}
```

- 결정 커버리지를 만족하려면:
  - 조건식 전체가 **true**인 케이스 1개 (예: `a=1, b=1`)
  - 조건식 전체가 **false**인 케이스 1개 (예: `a=0, b=1`)

장점

- “if/else, switch, 삼항 연산자” 같은 **분기 흐름을 최소한 양쪽으로** 실행하게 유도합니다.

한계

- `a>0`, `b>0` 각각이 참/거짓으로 모두 평가되는지는 보장하지 못합니다.

---

### 3. 조건 커버리지(Condition Coverage)

- 분기 조건식이 여러 조건으로 구성되어 있을 때,
  - **각 개별 조건이 참/거짓으로 최소 1번씩** 평가되는지를 봅니다.

위 예시에서:

- `a > 0` 이 참/거짓 모두 나오게
- `b > 0` 이 참/거짓 모두 나오게

예: `productionCode(1, 0)`, `productionCode(0, 1)`  
→ 개별 조건은 참/거짓을 모두 경험하지만, 조건식 전체(`a>0 && b>0`)가 **true가 되는 케이스**가 없어서 결정 커버리지는 만족하지 못할 수 있습니다.

장점

- 복합 조건에서 “개별 조건”을 더 촘촘히 다룹니다.

한계

- 조건이 많아질수록 필요한 테스트 조합이 급격히 늘어날 수 있습니다.
- 단락 평가(short-circuit) 때문에 어떤 조건은 아예 평가되지 않을 수 있어 설계가 필요합니다.

---

## 2) 커버리지가 높다고 무조건 좋은가?

결론: **아닙니다.**

### 커버리지가 보장하지 못하는 것

- **assert(검증)의 품질**
  - 라인을 실행만 하고 검증을 안 하면 커버리지는 올라가도 신뢰도는 낮습니다.
- **경계값/예외/동시성/타이밍 이슈**
  - 커버리지로는 “어려운 버그”를 잡았는지 알 수 없습니다.
- **테스트 유지보수성**
  - 억지로 커버리지를 맞추면 테스트가 과하게 구현 디테일에 묶여 리팩토링을 방해할 수 있습니다.

### 커버리지를 “유용하게” 쓰는 관점

- 목표는 “100%”가 아니라, **리스크가 큰 영역을 보호**하는 것입니다.
  - 결제/정산/권한/데이터 무결성 같은 핵심 도메인
  - 장애 시 영향이 큰 모듈
  - 변경이 잦고 회귀가 잦은 모듈
- 커버리지는 “지표”로만 활용하고,
  - **테스트가 무엇을 검증하는지(의도)**
  - **중요 경계/예외 시나리오가 있는지**
  - **회귀 방지 효과가 있는지**
    를 함께 봐야 합니다.

---

## 3) 실무에서 자주 쓰는 팁

- 라인 커버리지보다 **브랜치 커버리지**를 더 중요하게 보는 팀이 많습니다.
- “커버리지 게이트”를 둔다면:
  - 신규/변경 코드에 한정(변경 라인 기준)으로 관리하는 방식이 현실적입니다.
- 커버리지 숫자를 올리기 위한 테스트보다,
  - “버그가 났던 케이스를 재현 → 회귀 테스트로 고정”
    이 ROI가 큰 편입니다.

---

## 4) 한 줄 정리

코드 커버리지는 **테스트가 코드를 실행한 정도**를 보여주는 지표이고,  
품질을 올리려면 커버리지 수치보다 **중요 로직의 분기/경계/예외를 제대로 검증하는 테스트**가 핵심입니다.
