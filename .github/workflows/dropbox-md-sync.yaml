name: Sync Markdown from Dropbox

on:
  schedule:
    - cron: "0 0 * * *" # 한국시간 오전 9시
    - cron: "0 2 * * *" # 한국시간 오전 11시
    - cron: "0 4 * * *" # 한국시간 오후 1시
  workflow_dispatch:

jobs:
  sync-md-file:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Git config
        run: |
          git config --global user.name "김보성"
          git config --global user.email "bocastle1213@gmail.com"

      - name: Set up Dropbox API call
        run: |
          curl -X POST https://api.dropboxapi.com/2/files/list_folder \
            --header "Authorization: Bearer ${{ secrets.DROPBOX_ACCESS_TOKEN }}" \
            --header "Content-Type: application/json" \
            --data '{"path": "/Apps"}' \
            -o response.json

      - name: Check if bocelog folder exists
        run: |
          if jq -e '.entries[] | select(.name == "bocelog")' response.json > /dev/null; then
            echo "bocelog folder exists!"
          else
            echo "bocelog folder does not exist."
            exit 1
          fi
