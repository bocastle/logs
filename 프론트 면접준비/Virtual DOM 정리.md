# Virtual DOM 정리

## 1) Virtual DOM이란?

- **Virtual DOM**은 실제 DOM(Document Object Model)을 **자바스크립트 객체 트리**로 표현한 “가벼운 사본”입니다.
- React는 UI를 “state/props의 함수”로 보고, 상태가 바뀌면 **새 Virtual DOM 트리**를 만든 뒤 이전 트리와 비교(diff)해서 **필요한 실제 DOM 변경만 최소화**하여 반영합니다.

## 2) React에서의 처리 흐름

1. **상태 변경**: state/props 변경
2. **Render 단계**: 새 Virtual DOM(React 엘리먼트 트리) 생성
3. **Reconciliation(재조정)**: 이전 트리 vs 새 트리 차이 계산
4. **Commit 단계**: 계산된 변경분만 실제 DOM에 적용

## 3) 왜 성능에 도움이 되나?

- 실제 DOM 조작은 렌더링 파이프라인(스타일 계산 → 레이아웃 → 페인트 → 합성)에 영향을 주기 쉬워 비용이 큽니다.
- Virtual DOM은 **메모리 상에서 변경점 계산**을 먼저 하고, 브라우저가 부담스러운 DOM 변경을 **최소한으로 줄이는 방향**으로 업데이트를 모읍니다.
- 핵심은 “DOM 조작을 없애는 것”이 아니라, **DOM 조작 횟수/범위를 줄이고 업데이트를 체계화**하는 것입니다.

## 4) React가 diff를 효율화한 핵심 휴리스틱

React는 일반 트리 비교의 비싼 비용을 피하기 위해 다음 가정을 활용합니다.

### (1) 타입이 다르면 다른 트리로 간주

- 예: `<div>` → `<span>` 또는 `ComponentA` → `ComponentB`
- 타입이 다르면 해당 노드와 하위 트리를 **통째로 교체**합니다.
- 같은 타입이면 **속성(props)만 비교**해 바뀐 부분만 업데이트합니다.

### (2) 리스트는 `key`로 동일성(identity)을 추적

- 같은 레벨의 자식들을 비교할 때, React는 **`key`를 기준**으로 “어떤 항목이 유지/이동/추가/삭제 되었는지”를 판단합니다.
- `key`가 안정적이면 **불필요한 재생성/재마운트**를 줄이고, DOM 업데이트를 효율화할 수 있습니다.
- 주의: 인덱스를 `key`로 쓰면 재정렬/삽입/삭제 시 항목 동일성이 깨져 의도치 않은 UI 버그(입력값 꼬임 등)와 비효율이 생길 수 있습니다.

## 5) Virtual DOM에 대한 오해/주의점

- Virtual DOM이 **항상 더 빠른 것은 아닙니다.** 작은 변경이더라도 렌더 트리 재생성과 비교 비용이 존재합니다.
- 진짜 병목은 종종 **레이아웃/페인트, 큰 리스트 렌더링, 불필요한 리렌더링, 비싼 계산**에서 생깁니다.
- 따라서 성능 최적화는 “Virtual DOM이 있다”보다 **리렌더링 범위 최소화, 리스트 가상화, 메모이제이션, 상태 설계**가 더 직접적일 때가 많습니다.

## 6) 실무 체크리스트

- 리스트 렌더링 시 **안정적인 `key`(DB ID 등)** 사용
- 불필요한 리렌더가 문제라면 `React.memo`, `useMemo`, `useCallback`을 **측정 기반으로 선별 적용**
- 대용량 리스트는 `react-window`/`react-virtualized` 같은 **가상 스크롤(virtualization)** 고려
- 원인 파악은 **React DevTools Profiler**로 먼저 측정
