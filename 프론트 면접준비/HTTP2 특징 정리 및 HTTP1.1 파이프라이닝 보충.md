# HTTP/2 특징 정리 및 HTTP/1.1 파이프라이닝 보충

> 본 문서는 웹 브라우저 관점의 HTTP/2 동작을 중심으로, 성능 특성과 실무 적용 포인트를 정리합니다.

---

## 1) HTTP/2의 핵심 특징

### 1-1. 멀티플렉싱(Multiplexing)

- **하나의 TCP 연결** 위에서 **여러 요청/응답 스트림**을 **동시에** 주고받습니다.
- 각 요청은 **스트림 ID**로 구분되며, **프레이밍 계층**이 패킷을 분할·재조립합니다.
- 효과: **요청/응답 간 HOL(Head-of-line) 차단의 응용계층 문제** 해소, 리소스 로딩 병렬화.

### 1-2. 바이너리 프레이밍(Binary Framing)

- HTTP/1.x의 텍스트 기반 메시지를 **바이너리 프레임**으로 전송(헤더 프레임/데이터 프레임 등).
- 효율적 파싱·멀티플렉싱·우선순위 부여의 기반을 제공합니다.

### 1-3. 헤더 압축(HPACK)

- **정적/동적 테이블**과 **허프만 코딩**으로 중복 헤더를 크게 축소합니다.
- 쿠키·User-Agent처럼 **반복되는 헤더**의 전송 비용을 감소시킵니다.

### 1-4. 서버 푸시(Server Push)

- 클라이언트가 HTML을 요청하면, 서버가 **필요 리소스(CSS/JS 등)** 를 **사전 전송**할 수 있습니다.
- 실제 운영에서는 **캐시 중복·우선순위 오류·네트워크 낭비** 위험으로 **많은 플랫폼에서 비권장/비활성화** 추세입니다.
  - 대안: **Preload(`Link: rel=preload`)** 및 **HTTP/2 우선순위/리소스 힌트**(prefetch) 활용.

### 1-5. 스트림 우선순위 & 흐름 제어(Flow Control)

- 각 스트림에 **우선순위**를 부여하고, **윈도 크기** 기반 흐름 제어로 송수신량을 조절합니다.
- 대역폭 경쟁 상황에서 **중요 리소스** 우선 처리에 도움.

### 1-6. 연결 재사용 및 설정(SETTINGS)

- **커넥션 하나**로 **동일 오리진**의 요청을 재사용(커넥션 코알레싱은 조건부 가능).
- `SETTINGS` 프레임으로 **HPACK 테이블 크기**, **초기 윈도 크기** 등을 협상.

### 1-7. TLS/ALPN

- 사양상 **명시적 TLS 필수는 아님**(h2c 가능)이지만, **브라우저 구현은 TLS(HTTPS) 강제**가 일반적이며 **ALPN**으로 `h2`를 협상합니다.

> 주의: HTTP/2는 **TCP 레벨 HOL 차단**은 남아있습니다(패킷 손실 시 멀티플렉싱된 모든 스트림 지연). 이를 근본 해결한 것이 **HTTP/3(QUIC)** 입니다.

---

## 2) HTTP/1.1 파이프라이닝(Pipelining) 보충

- **개념**: 하나의 keep-alive 연결에서 **응답을 기다리지 않고** 요청을 **연달아** 보냅니다.
- **제약**: 서버는 **요청 순서대로** 응답해야 하므로, **앞선 요청 지연이 뒤 요청을 막는 HOL 차단**이 발생합니다.
- **현실**: 중간 프록시/서버 상호운용 문제와 HOL로 인해 **기본 비활성화**가 일반적이었고, 사실상 **실무에서 거의 사용되지 않음**.
- **대비**: HTTP/2 멀티플렉싱은 요청/응답을 **프레임 단위로 교차 전송**하여 파이프라이닝의 제약을 제거합니다.

---

## 3) HTTP/2 도입 시 실무 가이드

### 3-1. 프런트엔드 최적화 재고

- **도메인 샤딩**: 불필요. 한 연결에서 멀티플렉싱이 가능하므로 **오히려 역효과**(TLS/혼잡 증가).
- **스프라이트/대형 번들 강제**: HTTP/2에서는 **과도한 합치기**의 이점이 작아짐. 다만 **캐시 효율·중복 제거·압축** 관점에서 **합리적 청크**는 여전히 유효.
- **Preload 활용**: `Link: </main.css>; rel=preload; as=style`로 **초기 경로 중요 리소스**를 선제 로드.
- **우선순위 힌트**: `<link rel="preconnect">`, `<link rel="dns-prefetch">`, Priority Hints(`fetchpriority`) 등.

### 3-2. 서버/인프라

- **ALPN·TLS 최신화**: 최신 OpenSSL/라이브러리, 강한 암호군, 0-RTT(H2에는 해당 없음) 등.
- **HPACK 테이블 크기/우선순위 정책**을 벤더 권장값으로 시작, 실제 트래픽으로 튜닝.
- CDN/로드밸런서의 **HTTP/2 우선순위 스케줄링 구현 차이**를 테스트로 검증.

### 3-3. 관측/진단

- DevTools **Network** 패널에서 **프로토콜(h2)**, **리소스 워터폴**, **우선순위** 확인.
- **서버 푸시 사용 시** 캐시 히트·낭비 여부를 **엄격히 측정**(대부분은 preload가 더 안전).

---

## 4) 요약

- HTTP/2는 **멀티플렉싱·바이너리 프레이밍·HPACK·우선순위/흐름제어**로 HTTP/1.1의 성능 제약을 크게 완화합니다.
- HTTP/1.1의 **파이프라이닝은 HOL 차단**으로 실효성이 낮으며, HTTP/2는 이를 **프레임 단위 병행 전송**으로 극복합니다.
- 현대 프런트엔드에서는 **도메인 샤딩/스프라이트 남용**을 지양하고, **preload/우선순위 힌트**와 **적절한 코드 분할**을 조합하는 것이 바람직합니다.
