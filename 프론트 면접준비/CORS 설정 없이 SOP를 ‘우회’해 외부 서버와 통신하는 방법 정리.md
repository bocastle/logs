# CORS 설정 없이 SOP를 ‘우회’해 외부 서버와 통신하는 방법 정리

> 전제: **SOP(Same-Origin Policy)는 브라우저에만 적용**됩니다. 따라서 “브라우저가 직접 외부 Origin으로 요청하지 않게” 만들면, 실무적으로는 CORS 설정 없이도 외부 서버와 통신 흐름을 구성할 수 있습니다. 다만 이는 **CORS를 깨는 것이 아니라, 브라우저의 교차 출처 요청을 발생시키지 않도록 아키텍처를 바꾸는 것**입니다.

---

## 1) 리버스 프록시(동일 Origin 프록시)로 우회하기

### 핵심 아이디어

- 브라우저는 **자기 Origin(예: client.com)** 으로만 요청합니다.
- **client.com의 서버(또는 게이트웨이/프록시)** 가 외부 서버(server.com)로 요청을 “대신” 보내고 응답을 받아 브라우저로 전달합니다.
- 서버-서버 통신에는 SOP/CORS가 적용되지 않습니다.

### 요청 흐름

1. Browser → `https://client.com/api/external/...`
2. `client.com`(리버스 프록시) → `https://server.com/...`
3. `client.com`(프록시) → Browser로 응답 반환

### 장점

- 브라우저 관점에서는 동일 Origin 통신이라 CORS 이슈가 사라집니다.
- 인증 토큰/키를 브라우저에 노출시키지 않고 서버에서 안전하게 관리하기 쉽습니다.

### 주의 사항(매우 중요)

- **SSRF 방지**: 프록시가 임의 URL로 요청을 보낼 수 있으면 SSRF 취약점이 생길 수 있습니다.
  - 허용 도메인 allowlist, 경로 제한, 내부망/메타데이터 IP 차단(예: 169.254.169.254) 등이 필요합니다.
- **인증/인가 책임이 프록시로 이동**: 브라우저 사용자가 호출 가능한 외부 API 범위를 프록시에서 통제해야 합니다.
- **캐싱/레이트리밋/관측성**: 프록시를 두면 트래픽이 집중되므로 캐시 정책, rate limit, 로깅이 중요합니다.
- **쿠키/세션 전달 정책**: 외부 서버 인증이 쿠키 기반이면 프록시가 쿠키를 어떻게 처리할지 설계가 필요합니다.

---

## 2) 백엔드-포-프론트엔드(BFF) 패턴

### 핵심 아이디어

- 프론트엔드 전용 백엔드(BFF)를 두고, 브라우저는 BFF만 호출합니다.
- BFF가 여러 외부/내부 서비스를 조합해 필요한 형태로 응답을 만들어 줍니다.

### 언제 적합한가

- 외부 API를 단순 프록시하는 수준을 넘어,
- “프론트 화면에 맞는 데이터 조합/정규화/권한 필터링”이 필요할 때 유리합니다.

### 주의 사항

- BFF가 비대해지면 유지보수 비용이 증가할 수 있으므로 책임 범위(집계/조합 vs 비즈니스 로직)를 명확히 해야 합니다.

---

## 3) 서버리스/엣지 함수(Cloudflare Workers, Vercel/Netlify Functions 등)

### 핵심 아이디어

- (1), (2)를 “자체 서버” 대신 서버리스/엣지에서 수행합니다.
- 브라우저는 동일 Origin의 함수 엔드포인트를 호출하고, 함수가 외부로 요청을 대행합니다.

### 장점

- 운영 부담이 낮고, 지리적으로 가까운 위치에서 처리 가능(지연 감소)한 경우가 많습니다.

### 주의 사항

- 외부 API 호출 비용/쿼터, cold start, 런타임 제한(타임아웃/메모리)을 고려해야 합니다.
- 마찬가지로 SSRF/권한 통제는 필수입니다.

---

## “할 수는 있지만” 비추천하거나 제한적인 방법

### 1) JSONP

- `<script>` 태그로 타 도메인 스크립트를 로드하는 특성을 이용한 과거 방식입니다.
- GET만 가능하고 보안/유지보수 측면에서 현대에는 거의 쓰지 않습니다.

### 2) CORS 완화 브라우저 확장/플래그

- 개발 편의용으로는 가능하지만, 사용자 환경에 강제할 수 없고 운영 환경 대안이 될 수 없습니다.

---

## 결론

- **CORS 설정 없이 SOP를 “우회”하려면** 브라우저가 외부 Origin으로 직접 요청하지 않게 만드는 것이 핵심입니다.
- 실무 대안은 대부분 **리버스 프록시 / BFF / 서버리스(엣지) 프록시** 중 하나로 귀결됩니다.
- 이 방식은 편리하지만, **SSRF·인가 통제·레이트리밋·로깅** 같은 보안/운영 고려가 반드시 동반되어야 합니다.
