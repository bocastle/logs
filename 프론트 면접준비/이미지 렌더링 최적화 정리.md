# 이미지 렌더링 최적화 정리

> 핵심 요약: **용량 축소(포맷/압축) → 전송 최적화(CDN/캐싱) → 렌더링 최적화(반응형/지연로딩/우선순위)** 순으로 적용하면 체감 속도가 가장 크게 개선됩니다.

---

## 1) 포맷 최적화

- **AVIF / WebP 우선**, 필요 시 **JPEG/PNG** 폴백
  - 사진: AVIF(최고 압축), WebP(광범위 호환), JPEG(폴백)
  - 아이콘/로고: **SVG**(벡터) 우선, 그 외 투명 필요 시 PNG/WebP
- **EXIF 제거**, 적정 **퀄리티(예: 70~85%)**로 손실 압축
- **프로그레시브 JPEG**(점진적 표시) 고려

### `<picture>`로 호환성 확보

```html
<picture>
  <source srcset="/img/hero.avif" type="image/avif" />
  <source srcset="/img/hero.webp" type="image/webp" />
  <img src="/img/hero.jpg" alt="제품 전면 사진" width="1600" height="900" />
</picture>
```

---

## 2) 크기(해상도) 최적화 — 반응형 이미지

- **srcset + sizes**: 뷰포트에 맞는 **최적 소스 자동 선택**

```html
<img
  src="/img/card-800.jpg"
  srcset="
    /img/card-400.jpg   400w,
    /img/card-800.jpg   800w,
    /img/card-1200.jpg 1200w
  "
  sizes="(max-width: 600px) 90vw, 400px"
  alt="카드 미리 보기"
  width="400"
  height="240"
/>
```

- **DPR 대응**(레티나): `1x, 2x` 디바이스 픽셀 비율별 소스 제공
- 서버/이미지 CDN에서 **요청 시 리사이징**(Query 파라미터 기반 변환) 권장

---

## 3) 로딩 전략 — 지연 로딩과 우선순위

- **지연 로딩(Lazy Loading)**: fold 아래 이미지에 `loading="lazy"` 적용
- **우선 로딩(critical)**: Above-the-fold 히어로 이미지는
  - `fetchpriority="high"`(우선 다운로드)
  - `decoding="async"`(비동기 디코딩으로 메인 스레드 블로킹 완화)
  - 필요한 경우 `<link rel="preload" as="image" imagesrcset="..." imagesizes="...">`
- **LQIP/Blur-up**: 저해상도 프리뷰를 먼저 표시 후 고해상도 교체

```html
<img
  src="/img/hero-800.jpg"
  srcset="/img/hero-1600.jpg 1600w, /img/hero-2400.jpg 2400w"
  sizes="100vw"
  alt="히어로"
  width="1600"
  height="900"
  fetchpriority="high"
  decoding="async"
/>
```

---

## 4) CDN과 네트워크 최적화

- **CDN**으로 지리적 지연 감소, HTTP/2·HTTP/3, Brotli/ gzip 전송
- 이미지 CDN(Cloudinary, Imgix 등)으로 **실시간 변환/리사이징/포맷 자동 협상**
- **캐싱 정책**
  - 정적 에셋: `Cache-Control: public, max-age=31536000, immutable` + 파일명 **해시/버전링**
  - 빈번 변경: `ETag`/`Last-Modified`로 조건부 요청
- **CORS/Origin**: 크로스오리진 이미지는 올바른 CORS 헤더 설정

---

## 5) 레이아웃 안정성(CLS) 및 접근성

- **width/height 속성 명시** 또는 `aspect-ratio`로 자리 확보 → **레이아웃 시프트 방지**
- 의미 있는 **alt 텍스트** 제공
- 배경 이미지의 경우 **CSS `image-set()`**으로 다중 해상도 제공 가능

```css
.hero {
  background-image: image-set(
    url("/img/hero-1600.avif") type("image/avif") 1x,
    url("/img/hero-2400.avif") type("image/avif") 2x
  );
  aspect-ratio: 16 / 9;
}
```

---

## 6) 빌드/프레임워크 활용

- React/Next.js: `<Image>` 컴포넌트로 **자동 최적화**(리사이즈/포맷 협상/플레이스홀더)
- Vue/Nuxt, SvelteKit: 이미지 모듈 활용(유사 기능 제공)
- 정적 사이트 빌더(Gatsby, Astro): 빌드 타임 변환 + `srcset` 자동 생성

---

## 7) 체크리스트

- [ ] 사진은 AVIF/WebP 우선, 폴백 JPEG 준비했는가
- [ ] 화면 사이즈/DPR에 맞춘 `srcset + sizes`를 제공하는가
- [ ] fold 아래 자산은 `loading="lazy"` 적용했는가
- [ ] 히어로 이미지는 `fetchpriority="high"` / 필요 시 `preload` 했는가
- [ ] `width/height` 또는 `aspect-ratio`로 CLS를 방지하는가
- [ ] CDN/이미지 CDN을 사용하고 캐싱/버전 정책을 적용했는가
- [ ] EXIF 제거/적정 품질로 압축했는가
- [ ] 접근성(alt)과 CORS 헤더를 점검했는가

---

## 8) 요약

- **포맷**(AVIF/WebP/SVG)과 **크기**(리사이즈/반응형)가 볼륨을 줄이고,
- **지연/우선 로딩**이 체감 속도를 올리며,
- **CDN/캐싱**이 네트워크/전송 비용을 줄입니다.
- 레이아웃 안정성, 접근성, 빌드 도구를 함께 고려하시면 일관된 성능 개선 효과를 얻을 수 있습니다.
